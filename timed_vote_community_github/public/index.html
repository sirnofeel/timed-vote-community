
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>íƒ€ì„ë“œ íˆ¬í‘œ ì»¤ë®¤ë‹ˆí‹° (ë¡œê·¸ì¸ í•„ìˆ˜)</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>
<header class="top">
  <div class="brand">ğŸ—³ï¸ íƒ€ì„ë“œ íˆ¬í‘œ ì»¤ë®¤ë‹ˆí‹°</div>
  <nav>
    <button id="logout" class="btn ghost">ë¡œê·¸ì•„ì›ƒ</button>
    <a href="/new.html" class="btn">ìƒˆ ì£¼ì œ ë§Œë“¤ê¸°</a>
  </nav>
</header>

<main class="container">
  <h1>ìµœì‹  ì£¼ì œ</h1>
  <div id="list" class="list"></div>
</main>

<script>
async function ensureAuth(){
  const me = await fetch('/api/auth/me');
  if (!me.ok) { location.href='/login.html'; return; }
}
ensureAuth();

async function fetchTopics(){
  const res = await fetch('/api/topics');
  if (res.status===401) { location.href='/login.html'; return; }
  const data = await res.json();
  const list = document.getElementById('list');
  if (!data.topics.length) {
    list.innerHTML = '<div class="empty">ì•„ì§ ìƒì„±ëœ ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ì£¼ì œë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</div>';
    return;
  }
  list.innerHTML = data.topics.map(t => `
    <a class="card" href="/t/${t.id}">
      <div class="row">
        <h3>${escapeHtml(t.title)}</h3>
        <span class="badge ${t.status}">${t.status==='open'?'ì§„í–‰ì¤‘':'ë§ˆê°'}</span>
      </div>
      <p>${escapeHtml(t.desc||'')}</p>
      <div class="row small">
        <span>ë§ˆê°: ${new Date(t.deadline).toLocaleString()}</span>
        <span>ê³µê°œ: ${new Date(t.revealAt).toLocaleString()}</span>
        <span>íˆ¬í‘œìˆ˜: ${t.totalVotes}</span>
      </div>
    </a>
  `).join('');
}
function escapeHtml(s){ return s?.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])) }
fetchTopics();

document.getElementById('logout').onclick = async () => {
  await fetch('/api/auth/logout', { method:'POST' });
  location.href = '/login.html';
};
</script>
</body>
</html>
