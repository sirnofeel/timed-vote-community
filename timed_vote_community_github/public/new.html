
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ìƒˆ ì£¼ì œ ë§Œë“¤ê¸°</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>
<header class="top">
  <div class="brand">ğŸ—³ï¸ ìƒˆ ì£¼ì œ ë§Œë“¤ê¸°</div>
  <nav><a href="/" class="btn ghost">ëª©ë¡</a></nav>
</header>

<main class="container">
  <form id="form" class="card form">
    <label>ì œëª©</label>
    <input id="title" maxlength="120" placeholder="ì˜ˆ: ë‹¤ìŒ ë²ˆ ì˜¤í”„ëª¨ì„ ë‚ ì§œ íˆ¬í‘œ" required>

    <label>ì„¤ëª… (ì„ íƒ)</label>
    <textarea id="desc" rows="4" maxlength="2000" placeholder="ì£¼ì œì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>

    <label>ì„ íƒì§€</label>
    <div id="opts"></div>
    <div class="row">
      <button id="addOpt" type="button" class="btn ghost">ì„ íƒì§€ ì¶”ê°€</button>
      <span class="muted small">ìµœì†Œ 2ê°œ</span>
    </div>

    <label>ë§ˆê° ì‹œê°</label>
    <input id="deadline" type="datetime-local" required>
    <div class="muted small">ê²°ê³¼ëŠ” ë§ˆê° <b>10ë¶„ í›„</b> ê³µê°œë©ë‹ˆë‹¤.</div>

    <button class="btn" type="submit">ì£¼ì œ ìƒì„±</button>
  </form>
</main>

<script>
async function ensureAuth(){ const me = await fetch('/api/auth/me'); if (!me.ok) location.href='/login.html'; }
ensureAuth();

const optsBox = document.getElementById('opts');
function addOpt(value='') {
  const div = document.createElement('div');
  div.className = 'row';
  div.innerHTML = `<input class="opt" placeholder="ì„ íƒì§€" maxlength="80" value="${value.replace(/"/g,'&quot;')}" />
                   <button class="btn danger" type="button">ì‚­ì œ</button>`;
  div.querySelector('button').onclick = () => div.remove();
  optsBox.appendChild(div);
}
document.getElementById('addOpt').onclick = () => addOpt();
addOpt(); addOpt();

document.getElementById('form').onsubmit = async (e) => {
  e.preventDefault();
  const title = document.getElementById('title').value.trim();
  const desc = document.getElementById('desc').value.trim();
  const options = [...document.querySelectorAll('.opt')].map(i=>i.value.trim()).filter(Boolean);
  const deadline = document.getElementById('deadline').value;
  const res = await fetch('/api/topics', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ title, desc, options, deadline }) });
  const data = await res.json();
  if (!res.ok) { alert(data.error||'ì˜¤ë¥˜'); return; }
  location.href = '/t/' + data.topic.id;
};
</script>
</body>
</html>
